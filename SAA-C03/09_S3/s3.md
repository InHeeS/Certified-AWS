# S3

s3 는 백업과 스토리지로 활용됩니다. 파일용일 수도 있고 디스크용일 수도 있죠 
재해 복구 용도로 쓰이는 경우는 다른 리전으로 이동입니다. 어딘가에 백업됩니다.
아카이브용으로도 사용되는데 s3에 파일을 아카이브해 두면 추후 매우 손쉽게 검색 가능합니다. 
다음 용도는 하이브리드 클라우드 스토리지 입니다. 온프레미스에 스토리지가 있지만 클라우드로 확장하고자 한다면 s3를 사용 가능합니다. ㅓ
도한 애플리케이션을 호스팅하고 동영상 파일이나 이미지 등 미디어를 호스팅 가능합니다. 
정적은 웹사이트를 호스팅하기 위해서 다양한 용도로 쓰입니다.
데이터 레이크를 보유하여 다량의 데이터를 저장하고 빅 데이터 분석을 수행하기도 합니다. 

s3는 파일을 버킷에 저장하며 객체라고 표현합니다. 버킷은 계정안에 생성되며 전역적으로 고유한 이름이 있습니다. *반드시 특정 aws 리전에서 정의되어야 합니다.*  최대 크기는 5tb입니다. 크기가 큰 경우일 경우 멀티파트 업로드를 사용해서 해당파일을 여러 부분으로 나눠서 업로드 합니다. 

객체에는 메타 데이터가 있습니다. key-value 쌍 리스트를 말합니다. 이는 시스템이나 사용자에 의해 설정되어 파일에 관한 요소나 메타데이터를 나타낼 수 있습니다. 
태그의 경우 보안과 수명 주기에 유용하며 유니코드 키 -값 쌍은 최대 10개 까지 가능합니다. 

# S3 security

사용자 기반으로 iam 정책이 주어지며 어떤 api 호출이 특정 iam 사용자를 위해 허용되어야 하는지를 승인합니다.
리소스 기반 보안도 주어지며 s3 버킷 정책이라는 걸 사용 가능합니다. s3콘솔에서 직접 할당가능한 전체 버킷 규칙입니다. 특정 사용자가 들어올 수 있게 하거나 다른 게정의 사용자를 허용하는 s3 버킷에 액세스 가능케 하도록 하는 것을 교차 계정이라고 합니다. 

acl 객체 액세스 제어 목록으로 세밀하며 비활성화 가능합니다. 

암호 키를 사용하여 객체를 암호화 하는 것도 있습니다. 

일반적으로는 버킷 정책이 s3 버킷 정책에 첨부되면 객체에 대한 엑새스가 가능합니다. iam 사용자는 적절하지 않기에 iam 역할을 사용하며, 따라서 올바른iam 권한ㅇ르 통해 ec2 인스턴스 권한을 생성합니다. 

교차 계정 액세스를 허용하려면 버킷 정책을 사용합니다. 다른계정에 iam 사용자가 있고 추가 버킷 정책을 생성해서 특정 iam 사용자에게 교차 계정 액세스를 허용합니다. 따라서 iam 사용자는 s3 버킷으로 api 호출을 할 수 있게 됩니다. 

블록 공개 액세스 버킷 설정은 s3 버킷 정책을 설정해고 공개로 만들더라도 이설정이 활성화되어 있다면 버킷을 결코 공개되지 않습니다. 

# s3 정적 웹사이트 생성

s3는 웹 사이트를 호스팅하고 인터넷에서 액세스 가능하게 만들 수 있습니다(정적 웹사이트 생성시)

# s3 버전 관리 
s3 에서는 파일을 버전 관리 가능합니다. 이것은 버킷 수준에서 활성화해야하는 설정입니다. 이전 버전을 복구 가능한 롤백도 가능합니다. 
버전 관리를 활성화 하기전에 적용되지 않는 모든 파일은 널 버전을 갖게 됩니다. 버전 관리를 중단해도 이전 버전을 삭제하지는 않습니다. 버전 관리는 안전한 작업입니다. 

# S3 복제 기능

crr - 교차 리전 복제, srr - 같은 리전으로 복제 
복제는 비동기적으로 이루어지며 복제 과정은 백그라운드에서 이루어 집니다. 
CRR의 경우에는 컴플라이언스, 즉 법규나 내부 체제 관리, 그리고 데이터가다른 리전에 있어 발생할 수 있는 지연 시간을 줄일 경우에 사용합니다, 또한계정간 복제에도 쓸 수 있죠,

반면 SRR은다수의 S3 버킷간의 로그를 통합할 때나, 개발 환경이 별도로 있어운영 환경과 개발 환경간의 실시간 복제를 필요로 할 때사용될 수 있습니다

기존의 객체를 복제하려면
S3 배치 복제 기능을 사용해야 합니다
기존 객체부터 복제에 실패한 객체까지 복제할 수 있는 기능입니다

작업을 삭제하려면소스 버킷에서 대상 버킷으로 삭제 마커를 복제하면 됩니다
설정에서 선택하실 수 있습니다

버전 ID로 삭제하는 경우 버전 ID는 복제되지 않습니다
이는 영구적인 삭제로 누군가 악의를 품고
한 버킷에서 다른 버킷으로 ID 삭제 마커를 복제하면 안 되니까요

끝으로 체이닝 복제는 불가합니다
1번 버킷이 2번 버킷에 복제되어 있고
2번 버킷이 3번 버킷에 복제돼 있다고 해서
1번 버킷의 객체가 3번 버킷으로 복제되지 않습니다


![image](https://github.com/InHeeS/Certified-AWS/assets/105423951/ddfa0056-a8aa-4e47-8118-b538502cafc9)\

- 삭제 마커 복제 활성화 하면 삭제 마커도 한 버킷에서 다른 버킷으로 복제됩니다.
- 특정 버전의 파일을 삭제는 오리진 버킷에서 객체를 영구 삭제해도 복제 버킷에서는 삭제되지 않습니다. 복제 되는 것은 삭제 동작 그 자체가 아니라 삭제 마커입니다.

# s3 storage classes

내구성(Durability)은 Amazon S3로 인해 객체가 손실되는 횟수를 나타내는데요 
가용성은 서비스가 얼마나 용이하게 제공되는지를 나타내며 스토리지 클래스에 따라 다릅니다. 즉 1년에 53쓸수 없다는 뜻입니다. 

s3 standard 자주 액세스하는 데이터에 사용되며 지연시간이 짧고 처리량이 높으며 두개의 기능 장애를 동시에 버틸 수 ㅣㅇㅆ습니다. 사용 사례로는 빅데이터 분석 모바일 과 게임 애플리케[이션 그리고 콘텐츠 배포가 있습니다. 

s3 infrequent access 는 필요한 경우 빠르게 액세스해야 하는 데이터를 말하며 비용은 적게 들지만 검색 비용이 발생합니다. 

s3 standard ia 의 가용성은 99.9% 로 s3 standard 비해 약간 떨어집니다. 재해 복구와 백업이 있으며 

s3 one zone infrequent access 는 단일 az 내에서는 높은 내구성을 갖지만 az 파괴된 경우 데이터를 읽게 됩니다. 가용성은 99.5%입니다. 
사용 사례로는 온프레미스 데이터를 2차 백업하거나 재생성 가능한 데이터를 저장합니다. 

s3 intelligent 는 검색 비용이 없습니다. 객체를 이동시켜 주기 때문에 스토리지를 관리 할 수 있습니다. 

glacier storage classes 는 아카이빙과 백업을 위한 저비용 객체 스토리지입니다. 
amazon glacier flexible retrieval 에서 expedited 는 데이터를 1~ 5분 이내에 받을 수 있고 standard 는 3~5시간, 5~12시간
instan retrieval 는 밀리초 단위로 검색이 가능하며 분기에 한번 액세스하는 데이터에 아주 적합합니다. 

glacier deep archive 는 12시간은 standard, 48시간인 bulk 가 있습니다(데이터 검색)

# s3 quiz 

S3 버킷에 있는 콘텐츠를 다른 AWS 리전에서 완전히 가용할 수 있게 만들려고 합니다. 이는 팀원들이 적은 대기 시간과 비용으로 데이터 분석을 수행하는 데 도움이 됩니다. 이런 경우에 사용해야 하는 S3 기능은 무엇입니까?
Answer : s3 복제 
