# imds
- 인스턴스 메타데이터 서비스, 즉 IMDS의 개념이 뭐냐면 EC2는 자신에 대해 알 수 있는 방법이 있어요
- iam 역할을 사용하지 않고 특정 url 과 통신 하는 방법 즉 자신의 메타데이터를 알 수 있음
- 이 URL로 메타데이터랑 유저데이터 다 볼 수 있는데요
- IMDS v1, 보안 강화된 IMDS v2
- put 명령어로 세션 토큰을 얻어야하며 imds url d호출 가능
- 토큰을 헤더에 명시
- IAM 역할은 EC2 인스턴스 메타데이터 서비스를 통해 자격 증명을 제공하기 때문입니다

# aws cli
- aws configure 명령줄로 프로파일을 미리 구성할 수 있는 한 모든 명령줄에 --profile을 사용할 수 있습니다
- `cli or sdk 를 통해 다요소 인증을 사용하는 방법`
- `CLI를 사용하려면 임시 세션을 생성해야 하고 API를 사용하려면 STS GetSession Token을 사용해야 합니다`
- GetSession Token은 다요소 인증 장치로 자격 증명을 얻기 위해 호출하는 API입니다\
- STS GetSession Token인 CLI를 살펴보고 MFA 장치에 시리얼 넘버를 보내는데 MFA 장치의 토큰 코드와 원하는 자격 증명 기간입니다
- 이 임시 세션 토큰 생성에 사용한 API가 STS GetSession Token인 것과 임시의 액세스 키와 비밀 키 그리고 세션 토큰을 얻을 수 있다는 것입니다

# aws sdk
- cli 를 사용하지 않고 소프트웨어 개발 키트인 sdk 사용
- DynamoDB나 Amazon S3와 같은 Amazon 서비스에서 API 호출을 발행할 때 사용합니다
- 언제 sdk 를 쓰는지 aws serviced에서 api 호출을 발행할 대 사용

# aws limits quotas
- Amazon EC2의 DescribeInstances API는 초당 100회 호출의 제한이 있습니다
- Amazon S3의 GetObject는 접두부와 초당 5,500GET의 제한
- 때문에 지수 백오프 전략을 사용해야 합니다.
- 서비스 할당량을 늘리려면 서비스 할당량 API를 이용해서 프로그램에서 요청할 수 있습니다
- 간헐적 오류 발생 시에는 지수 백오프를 사용해야 합니다.
  - 조절 오류가 발생(api 호출일 많이 했기 때문에)
  - 즉 sdk를 실행하는 경우나 자체 사용자 정의 http 호출을 사용하는 경우 500 으로 시작하는 오류 코드의 서버 오류가 발생하면 재시도 메커니즘을 실행해야됨
  - 하지만 400 오류의 경우에는 재시도 혹은 지수 백오프를 실행해서는 안됩니다.
  - 지수 백오프를 통해 1,2,4,8,16 으로 서버의 부하가 점점 줄어든다.

# aws cli credentials provider chain
- cli 를 사용하면 이어지는 명령어에서 자격 증명을 요청합니다.
- 그래서 명령줄 옵션에서 리전, 출력값, 프로파일 혹은 액세스 키 ID와 비밀 액세스 키 그리고 세션 토큰을 지정하면 그 어떤 것보다 우선이 됩니다
- 다음으로는 환경 변수로 명령줄 옵션을 설정하지 않으면 환경 변수를 우선 적용합니다.
- 그리고 AWS configure를 실행할 때 CLI 자격 증명 파일을 살펴보고 CLI 구성 파일을 살펴보는데 동일한 방식으로 설정됩니다
- 마지막 우선순위는 EC2 프로파일 자격 증명이나 ECS 컨테이너 자격 증명입니다\

# aws sdk credentials provider chain
- java 시스템 속성이 최우선시 됩니다.
- 그다음 환경변수 액세스 키 id 나 비밀 액세스 키같은 것입니다.
- 환경변수가 앞서며 그다음 자격 증명 프로파일 파일과 컨테이너 자격 증명과 인스턴스 프로파일 자격 증명이 있습니다. 
- 가정
- EC2 인스턴스에서 애플리케이션을 배포하고 IAM 사용자의 환경 변수로 Amazon S3 API를 호출하는 상황입니다
- 자격 증명 모범 사례에서는 절대로 자격 증명을 코드에 저장하면 안 됩니다
  - AWS에서 작업을 실행하면 최대한 많이 IAM 역할을 사용해야 한다는 뜻입니다
- AWS를 사용하지 않으면 환경 변수를 사용하거나 CLI 구성할 때처럼 명명된 프로파일을 사용해야 합니다

# sining aws api requests
- 요청을 서명하려면 AWS 자격 증명을 활용해야 해요, 즉 액세스 키와 시크릿 키를 활용해야 해요
- API로 요청을 보낼 땐 서명을 해야 한다는 것, 그리고 서명은 SigV4 즉 Signature V4를 이용해야 합니다
  - sdk, cli 는 서명이 포함되어 있습니다.
- 하지만 알아 두셔야 하는 건 서명을 한 후 AWS에게 전달하는 방법이 두 가지 있다는 겁니다
  - 먼저는 어떤 HTTP 요청이든지 Authorization 헤더에 서명을 넣어 전달하는 방법입니다
  - 두 번째 방법은 쿼리 스트링을 이용하는 거예요 쿼리 스트링을 쓰니까 서명을 URL에 직접 넣게 됩니다.
  


