# CloudFront

*시험에서 cdn 을 본다면 cloudfront를 떠올리면 됩니다*
웹사이트의 컨텐츠를 서로 다른 엣지 로케이션에 미리 캐싱하여 읽기 성능을 높이는 것입니다. 
전세계의 사용자들이 낮은 레이턴시로 접근할 수 있어서 사용자 경험을 증대시킬 수 있습니다. 
cloudfront 는 ddos 로 부터 보호 가능합니다. 

cloudfront의 원본 제공 방식은 s3버킷으로 cloudfront 를 통해 파일을 분산하고 캐싱할 수 있게 합니다. 
그리고 버킷에는 cloudfront만 접근 가능하게 보장합니다.즉, origin access control 을 대체합니다. 
ingress 는 cloudfront를 통해 버킷에 데이터를 보내는 방법도 가느합니다. 

![image](https://github.com/InHeeS/Certified-AWS/assets/105423951/4b328a1f-49b9-4832-929c-11bc415f427c)

이렇게 cloudfront 와 엣지 로케이션을 이요해 특정 리전에 속한 s3 버킷을 전세계의 엣지 로케이션으로 분산 가능하게 합니다. 

cloudfront vs crr(교차 리전 복제)

cloudfront는 전세계으 엣지 네트워크를 이용합니다. 정적 컨텐츠를 사용하고자 할 때 용이합니다. 

교차 리전 복제는 복제를 원하는 각리전에 이 설정이 되어 있어야 합니다. 전세계 대상이아니며 파일을 거의 실시간을 갱신 됩니다 캐싱되지않고 읽기 전용 설정만 가능합니다. 동적 컨텐츠를 낮은 지연 시간으로 제공하고자 할대 유용합니다. 

정리하자면 cloudfront는 전세계에 걸친 컨텐츠 전송 네트워크이며, 반면 s3 교차리전 복제는 다른 리전으로의 버킷 복제입니다. 

# CloudFront alb or ec2 as an origin

cloudfront는 사용자 지정 http 백엔드에도 접근 가능합니다. 여기에는 ec2 인스턴스나 alb도 포함됩니다. 
사용자들이 cloudfront 를 통해 접근하며 사용자들은 cloudfront 엣지 로케이션에 접근하며 어플리케이션이 ec2 인스턴스에 요청을 보냅니다. 이둘 모두 퍼블릭으로 설정되어야 합니다. 
cloudfront에는 가상 프라이빗 클라우드가 없기 때문에 ec2 인스턴스에 접근할 수 없습니다. 

두번째 방식은 로드밸런서 역시 공용 설정이며 반면 ㅇec2 인스턴스는 프라이빗 설정을 사용해도 문제 없습니다. alb 와 ec2 인스턴스 사이에는 가상 프리이빗 네트워크가 설정되어있기 때문입니다. 
어플리케이션의 공용 ip가 로드 밸런서의 보안 그룹 정책에 허용이 되어 있어야 합니다. 

# cloudfront 지리적 제한 기능

사용자들에 지역에 따라 여러분들의 배포 객체 접근을 제한 가능합니다. 

# cloudfront price

cloudfront 고급옵션으로 요금과 가격 등급이 있습니다. 엣지 로케이션 마다 데이터 전송 비용이 다릅니다. 

요금은 대륙이나 지리 위치에 따라 각기 다른 요금이 책정되어 있습니다. 

가격등급은 3가지 가격 등급이 있습니다. 

price class all 은 비용이 많이 듭니다. 

price class 200 은 대부분의 리전을 사용 하지만 가장 비싼 리전은 제외됩니다. 

price class 100 은 가장 저렵한 리전만 사용합니다. 


# cloud front cache invalidations

cloudfront 엣지 로케이션은 우리가 백엔드 오리진을 업데이트할 대 업데이트 사항을 모릅니다. ttl이 만료되면 백엔드 오리진으로부터 어베이트된 콘텐츠를 받게 됩니다. 
우리는 전체 또는 일부의 캐시를 강제로 새로고침이 필요한데 이때 무효화를 실행할 수 있습니다. 
cloudfront는 캐시에 해당 파일이 ㅇ벗다면 엣지 로케이션은 오리진에 요청해서 업데이트된 새로운 index.html 파일을 받을 겁니다. 

# aws global accelerator 

공용 alb에 도달하기전에 여러개의 홉, 즉 라우터 또는 서버들이 있습니다. 공용인터넷을 거치기 때문입니다. 

지연시간을 최소화하기 위해 aws 네트워크를 통합니다. 이를 global accelerattor 사용합니다.

유니캐스트 ip는 하나의 서버가 하나의 ip주소를 가집니다. 

애니캐스트 ip는 모든 서버가 동일한 ip주소를 가지며 클라이언트는 가장 가까운 서버로 라우팅됩니다. 

global accelerator는 애니캐스트 ip개념을 사용합니다. 라우팅을 하게 되면 공용 인터넷을 거쳐 보내는 대신에 가장 가까운 엣지 로케이션과 통신합니다. 
엣지 로케이션으로부터 내부 aws 네트워크를 거쳐 alb로 곧장 연결됩니다. 

다음으로는 상태확인이 있습니다. 애플리케이션이 글로벌한지 확인합니다. 한 리전에 있는 한 alb에 대해 상태 확인을 실패하면 자동화된 장애 조치가 1분 안에 정상 엔드 포인트로 실행됩니다. 
덕분에 재해 복구에 특히 뒤어납니다. 두개의 외부 ip만 존재하기 대문에 보안 측면에서도 매우 안전하며 ddos 보호도 자동으로 받게 됩니다. 그 이유는 shield 덕분이죠 

--

accelerator 과 cloudfront 사이의 차이점으로느 둘다 동일한 글로벌 네트워크를 사용하고 둘 다 aws가 생성한 전 세계의 엣지 로케이션을 사용합니다. 둘다 shield 와 통합됩니다. 

cloud front 는 이미지나 비디오처럼 캐시 가능한 내용과 api 가속 및 동적 사이트 전달 같은 동적 내용 모두에 대해 성능을 향상시킵니다. 그리고 이 내용은 엣지 로케이션으로부터 제공됩니다. 

accelerator 는 tcp 나 udp상의 다양한 애플리케이션 성능을 향상시킵니다. 그러나 패킷은 엣지 로케이션으로부터 하나 이상의 리전에서 실행되는 애플리케이션으로 프록시됩니다. 캐싱이 불가능합니다. 즉, 게임이나 iot or void over ip 같은 비 http를 사용할 대도 매우 유용합니다. 또는 결정적이고 신속한 리전 장애 조치가 필요할 때도 좋습니다. 

# quiz 

Question 2:
S3 버킷 상에 호스팅된 정적 웹사이트가 있습니다. 요청을 더 잘 처리하고 성능을 향상시키기 위해 S3 버킷을 가리키는 CloudFront 배포를 생성했습니다. 얼마 후, 여러분은 아직도 사용자들이 S3 버킷에서 웹사이트로 직접 액세스할 수 있다는 것을 알게 되었습니다. 여러분은 사용자들이 CloudFront만을 통해서 웹사이트로 액세스하게끔 하려 합니다. 이를 위해서는 어떻게 해야 할까요?

Answer : cloudfront 배포를 구성해 원본 액세스 id를 생성한 후, s3 버킷이 오직 cloudfront 배포 oai 사용자들이 보내는 요청만을 수락하도록 업데이트 
