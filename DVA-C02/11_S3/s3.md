# s3
- Amazon S3는 백업이나 스토리지 용도로 잘 쓰입니다
- 온프레미스 형식으로 스토리지가 있는데 클라우드로 확장시키고 싶다면 애플리케이션을 호스팅하거나
- 비디오나 이미지 파일 같은 미디어 파일을 Amazon S3로 호스팅할 수 있어요, 데이터 레이크인 점이죠
- S3 버킷에 담기는 파일들은 객체라고 부르는데요
  - 특정 리전에서 해주어야 합니다. (리전안에서의 객체 생성)
- Amazon S3 객체 키는 파일의 전체 경로입니다
- 키는 접두사와 객체 이름으로 구성됩니다
- s3://my-bucket/my_folder1/another/folder/my_file.txt
  - 해당 부분에서 객체 이름은 my_file.txt, 키의 값은 my_folderI/another_foldder/my_file.txt
- 객체의 최대 크기는 5tb, 5gb를 넘는다면 멀티파트 업로드를 사용해야 합니다.
- 객체는 메타데이터를 가지며 키값 형태이며 태크도 유니코드 키 값 형태입니다.
- 버킷 이름은 AWS에서 생성된 모든 지역과 모든 계정에서 고유해야 합니다
- 자격 증명이 포함된 s3 객체 url 은 자신한테 보입니다.

# s3 security
- 사용자 기반 보안은 사용자 단위로 iam 정책을 적용하며 사용자가 api 호출할 지 정의합니다.
- 버킷 권한으로 자원 기반 보안이 있습니다. 계정간 액세스 권한을 위임
- acl 이라고 하는 액세스 제한 목록 존재하며, 버킷 단위로 설정
- 버킷 정책은 가장 많이들 적용하는 보안으로 그리고 명시적 거부 액션이 없다면 IAM 사용자는 허용된 API를 호출해 S3 객체에 접근할 수 있어요
- 암호화 키를 사용하는 방법으로 객체 암호화 방법이 있습니다.

# s3 bucket policy
- json 문서 이며
- ![image](https://github.com/user-attachments/assets/c29e1cda-2151-478f-be98-93628a258ca7)
- 같은 계정에 속한 사용자 즉 IAM 사용자가 Amazon S3에 접근해야 한다면 정책에 IAM 권한을 정의해 주면 됩니다
- IAM 사용자 기반은 적합하지 않다는 걸 이미 봤어요 IAM 역할을 사용해야 합니다 EC2 인스턴스 역할을 생성하고 IAM 권한을 제대로 설정해 주면 해당 EC2 인스턴스는 Amazon S3 버킷에 접근할 수 있어요
- 사례로, 계정 간 액세스를 허용하려면 버킷 정책을 사용해야 하는데요, 다른 계정의 IAM 사용자가 접근하게 하려면 해당 사용자에게 계정 간 액세스 권한을 명시해 줘야 해요, S3 버킷 정책에요
- 또 알아두셔야 하는 보안 설정은 버킷의 퍼블릭 액세스 차단 설정인데요

# static website hosting
- 어느 리전에서 생성하느냐에 따라 이 주소이거나 이주소가 됩니다.
- 퍼플릭 읽기 권한이 허용돼어 있으면 접근이 가능합니다.

# s3 versioning
- 버전 기능은 버킷 단위에서 설정해주어야 합니다.
- 예를 들어 어떤 파일의 버전을 삭제한다면 삭제 마커를 추가하는 것뿐이라서 원래 있던 버전을 복구시킬 수 있습니다

# s3 replication
- crr 은 교차 리전 복제이고 srr 은 동일 리전 복제입니다.
- 다른 리전의 버킷의 비동기 복제를 하기 위해서는 소스버킷과 대상 버킷 양쪽에 버전관리를 활성화 해야 합니다.
- 복제가 되려면 iam 권한을 부여해야 합니다.
- CRR을 사용하기 좋은 사례는 컴플라이언스나 저지연 액세스입니다, 다른 리전에 있는 걸 가져오니까요 계정 간 데이터를 복제할 때도 포함이 되죠
- SRR은 로그를 집계한다거나 운영 계정과 테스트 계정 사이에서 라이브 복제를 할 때 유용합니다

- 기존에 있던 객체를 복제하려면 S3 배치 복제 기능을 이용해야 해요
- 삭제 마킹이 있어도 대상 버킷으로 복제 가능
- 복제 체이닝은 지원되지 않기에 버킷 1에 있는 개체가 버킷 3으로 복제되지 않는다. 단 1->2, 2->3 으로 되었을떄

# s3 storage classes
- S3 Standard의 가용성은 99.99%인데요
  - 자주 액세스 하는 데이터를 저장하는데 쓰입니다.
  - 빅데이터 분석이나 모바일 앱, 게임, 콘텐츠 배포
- s3 infrequent access
  - 필요할 때 접근이 빠르며 standard 보다는 비용이 적지만 데이터를 조회할 때 비용 발생
  - ia 의 가용성은 99.9%이며 약간 적으며 재해 복구나 백업
- s3 one zone infrequent access 는 내구성이 높습니다. 한 가용 영역에서만요
  - 가용성은 99.5% 이며 온프레미스 데이터나 재생성 가능한 데이터의 백업 사본 만들기
 
- s3 glacier 는 저렴하며 아카이브나 백업을 위한 클래스이며 스토리지당 비용이 발생하고 검색 건당 비용이 발생합니다.
    - Amazon S3 Glacier Instant Retrieval은 밀리초 단위로 검색을 해줘서 좋습니다
      - 최소 스토리지 기간은 90일 이며 분기당 한번 액세스하는 데이터에 적합
      - 백업은 밀리초 단위로 액세스해야하는 데이터가 대상
    - Glacier Flexible Retrieval 검색옵션이 있고 expedited 는 1분 ~ 5분 이며 standard 는 3시간 ~ 5시간 bulk 는 5 ~ 12 시간 걸리며 최소 스토리지 기간 또한 90일 입니다.
    - Glacier Deep Archive 장기간 보관용 스토리지로 standard 12hour, bulk 48hour
      - 최소 스토리지 기간은 180dlf dlqslek. 
- S3 Intelligent-Tiering입니다, 액세스 패턴에 따라 객체를 액세스 계층 간에 이동시킬 수 있게 해줍니다(해다 부분이 기본 티어)
  - 그래도 검색 비용은 별도로 발생하지 않아요, 빈번한 액세스에 최적화된 티어, 여기로 옮기는 것도 자동이고
    - 빈번하지 않은 액세스에 최적화된 티어는 30일간 연속으로 액세스하지 않은 객체가 대상입니다
    - Archive Instant Access 티어는 90일동안 액세스되지 않은 객체가 자동으로 이동하는 티어예요
    - Archive Access 티어는 선택사항인데 액세스하지 않은 기간을 90일에서 700일 이상으로 설정할 수 있어요
    - Deep Archive Access 티어도 선택사항인데 180일에서 700일 이상 연속으로 액세스되지 않은 객체가 대상입니다
   - 즉 intelligent tiering 은 기간마다 해당 위의 s3 classes 를 선택가능합니다. 
