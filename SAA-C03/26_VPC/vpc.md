#CIDR D- IPV4

클래스 없는 도메인 간 라우팅을 살펴봅시다. 

먼저 기본 IP란 범위에 포함된 IP예요
일반적으로는 범위의 시작이 되는데
범위 내부에 있기도 합니다
예시로 10.0.0.0 또는 192.168.0.0 등이 있어요

다른 요소는 서브넷 마스크입니다
IP에서 변경 가능한 비트의 개수를 정의합니다

EX) IP 주소/32는
2의 0승으로 IP 하나만 허용합니다
그게 왼편에 있는 IP죠

IP 주소/31이라면
두 가지 IP가 허용됩니다
192.168.0.0과 192.168.0.1 말이에요

동일한 IP 주소/30의 경우
기하급수적으로 증가하는데 IP 네 개가 허용됩니다

건너뛰어서 /16으로 가면
2의 16승 개 IP가 바뀌니까 65,536개가 됩니다

![image](https://github.com/InHeeS/Certified-AWS/assets/105423951/2364fad0-74f5-4b53-a594-d66ea14ec889)

즉 IANA에서 구축한 특정 IPv4 주소 블록은
사설 LAN 네트워크 다시 말해 로컬 네트워크나

공용 인터넷 주소입니다
사설 IP는 특정 값만 허용합니다

# Default VPC Walkthrough

# vpc in aws - ipv4

단일 AWS 리전에 여러 VPC를 둘 수 있습니다
리전당 최대 5개까지 가능한데
엄격히 제한하지 않아서 여러분이 늘릴 수 있어요

VPC마다 할당된 CIDR는 다섯 개입니다
각 CIDR의 최소 크기는 /28로
IP 주소는 최소 16개가 있고요
최대 크기는 /16으로 IP 주소는 최대 65,536개입니다

VPC가 사설 리소스이기 때문에
사설 IPv4 범위만 허용됩니다

IPv4 CIDR를 추가할 수 있다는 점도 중요해요

# Adding Subnets

서브넷이란
VPC 내부에 있는 IPv4 주소의 부분 범위입니다

이 범위 내에서
AWS가 IP 주소 다섯 개를 예약합니다
IP 주소 처음 네 개, 마지막 한 개를 서브넷마다 예약해요

예를 들어 CIDR 블록 10.0.0.0/24가 있다면
일부는 예약된 IP 주소입니다
첫 번째는 네트워크 주소예요

AWS는 두 번째 .1을 VPC 라우터용으로 예약하고
10.0.0.2를 Amazon 제공 DNS에 매핑합니다
아주 중요한 부분이에요 .3은 당장 사용되진 않지만
나중에 필요할지 모르니까 예약해 두고요

네트워크 브로드캐스트 주소인 .255도 있는데
AWS는 VPC에서 브로드캐스트를 지원하지 않기에
예약은 되지만 사용하는 건 안 됩니다

EC2 인스턴스 서브넷에서 IP 주소 29개가 필요할 때
/27 서브넷은 사용 못 한다는 걸 시험 볼 때 기억해 두세요
/27 IP 주소는 32개인데
예약된 IP 주소 다섯 개를 제외하면
27개만 남기 때문입니다

29개가 필요하댔는데 그보다 작잖아요
따라서 서브넷 크기는 /26이어야 합니다

# 서브넷에 인터넷 액세스를 연결(igw)

인터넷 Gateway는 VPC의 리소스를
인터넷에 연결하도록 허용하는
EC2 인스턴스나 람다 함수 등입니다

VPC와는 별개로 생성해야 하고
VPC는 인터넷 Gateway 하나에만 연결되며
반대의 경우도 마찬가지입니다 인터넷 Gateway 자체는
인터넷 액세스를 허용하지 않습니다

![image](https://github.com/InHeeS/Certified-AWS/assets/105423951/1963e879-65fa-4188-9850-acd3abb83299)

따라서 인터넷 GateWay가 인터네소가 연결 가능합니다. 

퍼블릭 IPv4 주소가 있어도 인터넷에는 연결되어 있지 않습니다
이제 인터넷 게이트웨이가 필요한 타이밍이죠

인터넷 게이트웨이가 있어도 경로를 지정해 줘야 합니다
즉 라우팅 테이블을 수정해야 해요

현재 기본 라우팅 테이블은
서브넷 네 개와 연결되는데 이러한 방법보다는
명시적 서브넷 연결이 훨씬 좋은 방법입니다

이렇게 해야 서브넷을 올바른 라우팅 테이블에 할당할 수 있어요

![image](https://github.com/InHeeS/Certified-AWS/assets/105423951/93d3f432-f985-4c3e-b0ce-1a3fe70d56a7)


만약 이게 CIDR의 로컬 IP라면
경로도 로컬이 되어야 합니다
하지만 퍼블릭 IP를 포함한 다른 IP인 경우
대상은 인터넷 게이트웨이가 됩니다

# bastion Hosts 

사용자가 프라이빗 서브넷에 없는 EC2 인스턴스에 액세스하고자 합니다
사용자인 우리는 퍼블릭 인터넷에 있는데
이는 사용자의 EC2 인스턴스가 프라이빗 서브넷에 위치하지 않기 때문이죠

프라이빗 서브넷에 대한 인터넷 액세스는 없습니다

이때 퍼블릭 서브넷에 있는 EC2 인스턴스 즉 배스천 호스트로
프라이빗 서브넷에 있는 EC2 인스턴스에 액세스할 수 있습니다

*시험에는 보안 규칙 관련 내용도 출제되는데
무엇을 정의할 수 있는지 잘 이해하셔야 합니다
배스천 호스트를 위해서는 보안 그룹이 반드시 인터넷 액세스를 허용해야 합니다
하지만 모든 인터넷 액세스를 허용하면
보안상 위험이 크기 때문에
가령 기업의 퍼블릭 CIDR 액세스만 허용하거나 사용자의 인터넷 액세스만 허용하는 등
이를 제한하는 게 좋겠죠
이렇게 배스천 호스트의 EC2 보안 그룹을 최대한 제한하여
특정 IP만 액세스가 가능하도록 설정할 수 있습니다*

프라이빗 서브넷의 EC2 인스턴스 보안 그룹에서는
반드시 SSH 액세스를 허용해야 합니다
따라서 포트 22번이 배스천 호스트의 프라이빗 IP가 되거나
배스천 호스트의 보안 그룹이 되는 셈이죠


