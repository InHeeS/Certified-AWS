# Container

docker : 앱 배포를 위한 소프트웨어 개발 플랫폼입니다. 사용 사례에는 마이크로서비스 아키텍처가 있습니다. 또한 온프레미스에서 클라우드로 앱을 리프트-앤-시프트 하기도 합니다. 

도커 이지지는 도커 리포지토리에 저장합니다. 

첫번째로는 docker hub 퍼플릭 리포지토리입니다. 

두번째로는 프라이빗 리포지토리인 ecr 이 있습니다. 

도커 역시 순전히 가상화 기술은 아닙니다 한 서버에서 다수의 컨테이너를 공유할 수있습니다. 

ec2와는 다르게 도커는 하나의 서버에 많은 컨테이너를 실행합니다. 
도커를 시작하려면 우선 dockerfile을작성합니다. 컨테이너를 구성하는 파일입니다. 

aws에서 도커 컨테이너를 관히라는 방법은 ecs 입니다. eks 는 kubernates 의 관리형 버전으로 오픈 소스 프로젝트입니다. 

# ecs

aws 에서 컨테이너를 실행하면 ecs클러스터에 이른바 ecs 태스크를 실행합니다. ec2 인스턴스가 들어있습니다. 인프라를 직접 프로비저닝하고 유지해야 합니다. 각각의 ecs 에이전트를 실행해야 합니다. 

두번째 시작 유형은 fargate 시작 유형입니다. 도커 컨테이너를 실행 하며 인프라를 프로비저닝 하지 않아 관리한 ec2 인스턴스가 없습니다. 서버리스입니다. 

서버리스는 서버를 관리하지 않아 서버리스라 부르는데 서버가 없는건 아닙니다. 

ec2 태스크를 정의하는 태스크 정의만 생성하면 aws가 대신 실행합니다. 

--

*ec2 태스크의 iam 역할을 살펴보면 ecs 에이전트만이 ec2 인스턴스 프로파일을 사용하며 ec2 인스턴스 ㅍ로파일을 이용해 api 호출을 합니다. 그렇게 되면 cloudwatch 로그에 api 호출을 해서 컨테이너 로그를 보내고 ecr 로부터 도커 이미지를 가져옵니다.*

*ec2 시작유형을 사용한다면 ec2 인스턴스 프로파일을 생성합니다.*

*s3 는 ecs 태스크에 파일 시스템으로 마운트 될 수 없습니다.*

*efs 를 연결하여 데이터를 공유하고 fargate 로 서비리스 방식ㅇ로 ec2 태스크를 실행하고 파일 시스템 지속성을 위해서는 efs 사용하는 것이 가장 좋습니다.*


