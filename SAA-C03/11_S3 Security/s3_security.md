# s3 암호화

1. 서버측 암호화 즉 sse, sse-s3 sms s3에서 관리하는 키를 이용한 서버 측 암호화 입니다. 버킷과 객체에 대해 기본값으로 활성화 되어있습니다.
2. kms 키를 이용해서 암호화 키를 관리합니다.
3. sse-c 는 우리가 가진 키를 공유하며
4. 클라이언트 측 암호화가 있습니다. 클라이언트 측의 모든 걸 암호화 한 다음에 s3에 업로드 합니다.

sse-s3 는 aws 가 처리하고 관리하고 소유한 키를 이용해서 암호화 하고 우리는 액세스 불가능합니다. 객체는 aws에 의해 서버 측에서 암호화 되며 aes-256입니다. 

kms 는 키 관리 서비스는 직접 자신의 키를 관리하려고 하며 사용자가 키를 통제 가능하며 직접 키를 생성하능합니다. cloudtrail 을 이용해서 키사용을 검사하며 로깅하는 서비스 cloudtrail에 로깅됩니다. 서버측에서 암호화 됩니다. 
s3 버킷의 처리량이 아주 많고 모든 게 kms 키로 암호화되어 있다면 스로틀링 활용 사례가 됩니다. 

sse-c는 aws 외부에서 키가 관리되지만 서버측암호화에 해당합니다. 우리가 키를 aws로 전송하기 때문입니다. 
키를 s3로 전송하기 대문에 https 를 사용해야 합니다. 사용자는 파일과 키를 업로드하며 사용자가 aws 외부에서 키를 관리합니다. 클라이언트가 제공한 키와 객체를 사용해서 암호화를 수행하고 암호화된 파일을 s3버킷에 넣게 됩니다. 

클라이언트 측 암호화는 클라이언트가 직접 데이터를 암호화한 다음에 s3에 전송한다는 개념입니다. 

객체의 모든 암호화 수준을 알아봤습니다. 다음은 전송 중 암호화는 ssl or tls 라고 불리며 https 전송을 말합니다. 

DSSE-KMS는 "KMS를 기반으로 한 이중 암호화"일 뿐입니다.

# s3 기본값 암호화 

기본값 암호화는 sse-s3암호화가 되어 있습니다. 우리는 버킷 정책으로도 버킷 안의 암호화를 강제할 수 있습니다. 
버킷 정책은 항상 여러분의 기본값 암호화 설정 이전에 평가 됩니다. 

# cors

오리진은 체계(프로토콜)와 호스트(도메인)와 포트로 구성됩니다.  
cors는 웹 브라우저 기반 보안 메커닞므으로 메인 오리진을 방문하는 동안 다른 오리진에 대한 요청을 허용하거나 거부합니다. 

오리진이 같다는 뜻은 체계,호스트,포트가 동일할 대 오리진이 같다고 말합니다. 

![image](https://github.com/InHeeS/Certified-AWS/assets/105423951/1457f0de-cce4-464f-b55b-1a7eb7225068)

s3는 버킷에서 교차 오리진 요청을하면 정확한 cors헤더를 활성화해야합니다. *특저 오리진을 허용하거나 \*를 붙여 모든 오리진을 허용합니다* 그렇게 되면 다른 오리진에서 s3 버킷에 들어있는 이미지, 자산, 파을을 요청합니다. 

*14-7 강의 중요 다시보기*

# mfa delete 보안 기능

mfa 는 멀티팩터 인증을 의미합니다. mfa는 코드를 생성하는데 중요한 작업을 수행하기 전에 s3에 해당 코드를 삽입합니다. 객체 버전을 영구적으로 삭제할 대 필요합니다. 도한 버킷에서 비저닝을 중단할 대도 필요합니다. 

버킷 소유자, 즉 루트 계정만이 MFA Delete를 활성화하거나 비활성화할 수 있습니다 실습 강의에서 확인하죠, MFA Delete는 추가 보호 기능이며 특정 객체 버전의 영구 삭제를 방지하는 역할을 한다는 점만 기억하세요

# s3 access logs

어던 계정에서든 s3로 보낸 모든 요청은 승인 또는 거부 여봐와 상관없이 다른 s3 버킷에 파일로 기록도비니다. amazon athena 와 같은 데이터 분석 도구로 분석합니다. 모든 요청이 로깅 버킷에 기록되도록 설정하며 로킹 버킷을 모니터링하는 버킷과 동일하게 설정하면 안됩니다. 

로그의 내용은 api 호출과 성공률 및 누가 액세스했는지, 어떤 버킷인지 시간 등의 정보를 제공합니다. 

# s3 미리 서명된 url

s3, sli, sdk, 를 사용하여 생성 가능한 url 입니다. url에는만료기간이 있습니다. s3콘솔을 사용하면 최대 12시간이고 cli 를 하면 168시간 가능합니다. URL을 받는 사용자는 URL을 생성한 사용자의 
GET 또는 PUT에 대한 권한을 상속합니다

버킷 소유자 또는 사용자로서 해당 파일을 가지고 미리 서명된 url을 생성하며 s3 버킷이 url을 제공하고 해당 url은 미리 서명됩니다. url이 자격 증명을 이어받아 해당 파일에 액세스할 수 있는 권한을 부여합니다. 즉, 특정 파일을 임시로 액세스 할 때 아주 널리 사용되는 방법입니다. 버킷을 비공개로 유지하면서요 

![image](https://github.com/InHeeS/Certified-AWS/assets/105423951/e8aa4b17-07cc-4f6b-8bca-27dba3c8bc14)

# s3 glacier 볼트 잠금

worm 모델을 채용하기 위해 gllacier 볼트를 잠그는 겁니다.
worm 은 한번 쓰고 여러번 읽는다는 뜻입니다. 
객체를가져와서 s3 glacier 볼트에 넣은 다음 수정하거나 삭제할 수 없도록 잠금니다. 
관리자나 aws서비스를 사용해도 삭제 할 수 없기에 규정 준수나 데이터 보존 같은 볍률적인 사항에 아주 유용합니다. 즉 glaceir 옵션입니다. 

이와 유사한 s3 옵션은 객체 잠금을 활성화하려면 먼저 비저닝을 활성화하며 여기서도 worm 모델ㅇ르 채택하며 s3 버킷 수준의 잠금 정책이 아니라 버킷 내의 모든 객체에 각각 적용 가능합니다. 

*이는 두가지 보존 모드가 있습니다.* 1. 규정 준수 모드로 s3 glacier과 유사합니다. 하지만 관리자와 같은 일부 사용자는 iam을 통해 부여받은 특별 권한으로 보존 기간을 변경하거나 객체 삭제 가능합니다. 

반면 거버넌스 보존 모드는 일부 사용자가 관리자 권한을 갖고 객체를 변경 가능합니다. 

추가적으로 s3객체 잠금으로 할수 있는 일은 객체에 '법적 보존' 상태를 설정합니다. 
법적 보존을 설정하면 s3 버킷 내 모든 객체를 무기한으로 보호합니다. s3:putobjectlegalhold iam 권한을 가진 사용자는 어던 객체에든 법적 보존을 설정하거나 제거 가능합니다. 

# s3 access points

사용자와 데이터가 많아질수록 관리하기 어려운데 이건 s3 액세스 포인터로 해결 가능합니다. 
모든 액세스 포인트는 각자 보안을 가지고 있습니다. 따라서 적절한 iam 권한이 있다면 액세스 가능합니다. 
즉, 엑세스 포인트는 s3 버킷의 보안 관리를 간소화 하며 액세스 포인트의 각자의 dns 이름을 갖게 됩니다. 그걸로 액세스 포인트에 접속하며 액세스 포인트가 인터넷 오리진에 연결되거나 프라이빗 트래픽의 경우에 vpc 오리진에 연결되도록 합니다. 이렇게 보안 관리를 스케일링합니다. 

![image](https://github.com/InHeeS/Certified-AWS/assets/105423951/cced3cc8-f32e-470f-86ca-84e4f660533c)

# s3 객체 람다

액세스 포인트의 또 다른 활용 사례로 호출자 애플리케이션이 객체를 받기 직전에 그 객체를 수정하는 경우에 해당합니다. 우리의 버킷을 복제해서 버킷에 각 각체의 다른 버전을 갖는 대신에 s3 객체 람다를 사용합니다. 액세스 포인트와 객체 람다를 만들어서 s3 버킷 하나로만 원하는대로 데이터 수정이가능합니다.

사용 사례로는 pii 데이터, 즉 개인식별정보를 삭제하는경우, 데이터 형식을 xml to json 으로 변환하는 경우 즉석에서 이미지 크기를 조정하거나 워터마크를 추가하는 등의 원하는 변환을 수행하는 경우입니다. 

![image](https://github.com/InHeeS/Certified-AWS/assets/105423951/e0e09103-bda8-4c43-806e-2ffd8f063575)


# quiz

Question 1:
고객이 S3에서 파일 암호화가 수행되도록 하고 싶지만 암호화 키는 AWS 저장하지 않고 본인이 온전히 관리하고 싶다고 합니다. 이럴 경우 ........................... 를 사용할 것을 권장합니다.

Answer : SSE-C를 사용하면 암호화는 AWS 서버 측에서 수행되고, 암호화 키에 관한 모든 제어권은 이용자가 갖습니다.

cf: SSE-KMS를 사용하면 암호화가 AWS 서버 측에서 진행되고 암호화 키 관리도 AWS에서 하지만, 암호화 키 순환 정책에 관한 제어권은 모두 이용자에게 있습니다. 암호화 키는 AWS에 저장됩니다.

Question 11:
회사에서 S3 버킷에 데이터와 파일을 저장하고 있습니다. 이 파일 중 일부는 회사 규정 준수 정책에 따라 정해진 기간 동안 보관해야 하며 덮어쓰거나 삭제되지 않도록 보호해야 합니다. 이런 경우에 사용할 수 있는 S3 기능은 무엇입니까?

Answer : s3 객체 잠금 - 보존 규정 준수 모드 


Question 12:
다음의 S3 객체 잠금 설정 중에서 객체 또는 객체 버전을 무기한 덮어쓰거나 삭제할 수 없도록 방지하고, 수동으로 삭제할 수 있는 기능만을 제공하는 설정은 무엇입니까?

Answer : 법적 보존 
