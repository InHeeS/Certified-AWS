# DNS

domain name system 으로 사람에게 호스트 이름을 대상 서버 ip주소로 번역해 줍니다. url 과 호스트트 이름을 ip로 변환한다고 이해합니다. 

도메인 registry 는 도메인 이름을 등록하며 dns 레코드에는 여러 종류가 있습니다.  

![image](https://github.com/InHeeS/Certified-AWS/assets/105423951/7eed126f-c9be-4078-b19a-d25f6f16153c)

dns 의 동작방식을 살펴보면 웹서버가 있고 공인 ip가 있고 도메인 이름을 이용해 접근하고자 합니다.
도메인 이름을 dns 용 서버에 등록합니다. 웹브라우저가 example.com 에 접근하기 위해서는 로컬 dns 에게 물어봅니다. 알지 못한다면 . icann 에 의해 관리된 dns 서버의 루트에 물어봅니다.
알지 못한다면 .com 은 이름 서버(ns) 레코드로 공인 ip 1.2.3.4 로 가보라고 알려주며 최상단 도메인에 물어보게 됩니다. 따라서 1.2.3.4 에 있는 .com 도메인 서버에게 쿼리의 답을 요청합니다. iana 에 의해 관리되는 서버입니다. 다음 공용 ip를 물어보게 되며 
로컬 dns 서버는 최종 서버로 서브 도메인의 dns 서버입니다. 예를 들어 route53 이 있습니다. 때문에 dns 서버는 example.com 을 아냐고 물어보게 되며 결과로 ip를 얻게 되는 것입니다. 

# Route 53

고가용성, 확장성을 갖춘, 완진히 관리되며 권한있는 dns 입니다. 
고객은 dns 레코드를 업데이트 하며 권한을 갖게 됩니다. 즉, dns에 대해 완전히 제어 가능합니다. dns 레코드를 아마존 route 53의 호스팅 존에 쓰려가 합니다. 클라이언트가 요청을 하게 되면 ip를 찾고 있다고 응답하며 클라이언트는 바로 ec2 인스턴스에 접근합니다. 

100% sla 가용성을 제공하는 유일한 aws 서비스입니다. 여러 dns 레코드를 정의하고 레코드를 통해 특정 도메인으로 라우팅하는 방법을 정의합니다.
라우팅 정책은 route 53이 쿼리에 응답하는 방식입니다. 
ttl 은 dns 리졸버에서 레코드가 캐싱 되는 시간입니다. 
*a, aaaa, cname, ns*

a 레코드는 호스트 이름과 ipv4 ip를 매핑합니다. 

aaaa 는 호스트 이름을 ipv6주소에 매핑합니다. 

cname 은 호스트 이름을 다른 호스트 이름과 매핑합니다. 
물론 대상 호스트 이름은 a 나 aaaa 가 될수 있ㅅ브니다. 
route 53 에서 dns 이름 공간 또는 zone apex의 상위 노드에 대한 cnames를 생성 불가능 합니다. 예를 들어 example.com에 CNAME을 만들 수는 없지만 www.example.com에 대한 CNAME 레코드는 만들 수 있습니다

ns 는 호스팅 존의 이름 서버입니다. 서버의 dns 이름 또는 ip주소로 호스틍 존에 대한 dns 쿼리에 응답할 수 있습니다. 또한 트래픽이 도메인으로 라우팅 되는 방식을 제어합니다. 
호스팅 존이란 레코드의 컨테이너 입니다. 퍼플릭 도메인 이름은 퍼블릭 호스팅 존을 만들 수 있습니다. 
프라이빗 호스팅 존은 vpc 만이 url을 리졸브 가능합니다. 

퍼플릭 호스팅 존은 공개된 클라이언트로부터 온 쿼리에 응답 가능합니다. 웹 브라우저에서 example.com 을 요청하면 ip를 반환합니다. 
프리이빗 호스팅 존은 오직 프라이빗 리소스, vpc 에서만 쿼리 가능합니다. 

# TTL

클라이언트에게 결과를 캐시하도록 요청합니다. 300초동안 클라이언트는 결과를 캐시합니다. 같은 호스트 이름으로 접속할 경우 클라이언트는 dns 시스템에게 쿼리를 보내지 않아도 되는 것입니다.

ttl 이 짧으면 dns에는 트래픽의 양이 많아져서 비용이 많이 들게 됩니다. 모든 레코드에 있어 필수적입니다. 별칭 레코드는 제외됩니다. 

# CNAME vs Alias

cname 은 호스트 이름이 다른 호스트 이름으로 향하도록 할 수 있습니다. 루트 도메인 이름이 아닌 경우에만 가능합니다. 

별칭 레코드는 호스트 이름이 특정 aws 리소스로 할 수 있습니다. 별칭 레코드는 루트 및 비루트 도메인 모두에 작동합니다. 루트 도메인은 mydomian.com 을 별칭으로 사요해 aws 리소스로 향하도록 할 수 있습니다. 자체적으로 상태 확인도 가능합니다. 또한 cname 과는 다르게 zone apex라는 dns 네임스페이스의 상위 노드로 사용 가능합니다. 또한 ttl을 설정 불가능합니다. route 53에 의해 자동으로 설정됩니다. 

별칭 레코드의 대상으로는 elb가 되거나 cloudfront 가 될 수 있습니다. api gateway, elatic beanstalk, s3 에도 가능합니다. s3 bucket에는 안되고 버킷들이 웹사이트로 활성화될 시 s3 웹사으트는 가능합니다. vpc 인터페이스 엔드포인트 global accelerator 가속기 동일 호스트 존의 route 53 대상으로 가능합니다.  *ec2 의 dns 이름에 대해서는 별칭 레코드를 설정 불가능합니다.*

# route 53 routing policies

라우팅 정책은 route 53 가 dns 쿼리에 응답하는 것을 돕습니다. 
dns 는 트래픽을 라우팅하지 않습니다. dns 는 호스트 이름들을 클라이언트가 실제 사용 가능한 엔드 포인트로 변환하는 것을 돕습니다. 

단순 라우팅 정잭은 트래픽을 단일 리소스로 보내는 방식입니다. 동일한 레코드에 여러 개의 값을 지정하는 것도 가능합니다. 때문에 상태 확인은 불가능합니다. 

가중치 정잭은 가중치를 활용해 요청읠 일부 비율을 특정 리소스로 보내는 식의 제어가 가능합니다. dns 응답의 70%는 첫번째 ec2 인스턴스로 리다이렉팅 됩니다. 사용되는 경우로는 서로  다른 지역들에 걸쳐 로드 밸런싱을 할 때나 적은 양의 트래픽을 보내 새 애플리케이션을 테스트하는 경우에도 사용합니다. 

지연 시간 기반 라우팅 정책은 지연 시간이 가장 짧은, 즉 가장 가까운 리소스로 리다이렉팅을 하는 정책입니다. 지연 시간에 민감한 웹사이트나 애플리케이션이 있는 경우에 아주 유용한 정책입니다. 지연 시간의 작동 여부는 vpn을 사용합니다. 

장애 조치 정잭은 상태 확인과 기본 레크드를 연결하며(필수적) 상태 확인이 비정상으면 2번째의 ec2 인스턴스로 장애 조치하며 결과를 보내기 시작합니다. 

지리 위치 정책은 사용자의 실제 위치를 기반으로 합니다. 가장 정확한 위치가 선택되어 그 ip로 라우팅 되는 것입니다. 일치하는 위치가 없는 경우는 기본 레코드를 생성합니다. 사용사례로는 콘텐츠 분산을 제한하고 로드 밸런싱 등을 실행하는 웹사이트 현지화가 있습니다. 

지리 급접 라우팅은 사용자와 리소스의 지리직 위치를 기반으로 트래픽을 리소스로 라우팅하도록 합니다. 편향값을 사용하여 특정 위치를 기반으로 리소스를 더 많은 트래픽을 이동하는 것입니다. *지리 근접 라우팅은 편향을 증가시켜 한 리전에서 다른 리전으로 트래픽을 보낼 대 유요하다는 것입니다.*

ip 기반 라우팅은 클라이언트 ip 주소를 기반으로 라우팅을 정의합니다. cidr 목록을 클라이언트의 ip 범위로서 cidr 에 따라 트래픽을 어느 로케이션으로 보내야 하는지 정합니다. 때문에 비용 절감 및 성능을 최적화 합니다. ip를 미리 알고 있기 때문입니다.

다중값 라우팅 정책은 트래픽을 다중 리소스로 라우팅할 때 사용합니다. route 53은 다중 값과 리소스를 반환합니다. 상태 확인과 연결하면 다중 갑 정책에서 반환되는 유일한 리소스는 정상 상태 확인 과 관련이 있습니다. 

# route 53 상태확인 

상태 확인은 주로 공용 리소스에 대한 상태를 확인하는 방법입니다. 공용 엔드 포인트를 모니터링하며, 애플리케이션, 서버 혹은 다른 aws 리소스가 될 수 있습니다. cloudwatch 경보의 상태를 모니터링 하는 상태 확인도 있습니다. 공용 엔드 포인트로 오게된 요청의 18% 이상의 상태확인이 정상이라고 판단하면 route 53도 정상이라고 판단합니다. 상태 확인의 작동이 가능하려면 상태 확인이 여려분의 애플리케이션 밸런서나 엔드 포인트에 접근이 가능해야 합니다. 

개인의 리소스를 모니터링 하는 것은 cloudWatch 경보를 상태 확인에 할당하여 개인 서브넷 안에 있는 ec2 인스턴스를 모니터 합니다. 

# domain registar vs dns service 

domain registar 를 통해 원하는 도메인 이름을 구매 가능합니다. amazon 호스트 이름으로 dns 이름을 등록했다면 dns 레코드 관리를 위한 route 53 호스팅 존을 가집니다. 

타사 등록 대행사에서 구매해도 route 53을 사용 가능한데 사용하려면 route 53 공용 호스팅 영역을 생성한뒤 도메인을 구매한 타사 웹사이트에서 ns 혹은 이름 서버를 업데이트하면 route 53 이름 서버를 가리키게 됩니다. 

# quiz 


