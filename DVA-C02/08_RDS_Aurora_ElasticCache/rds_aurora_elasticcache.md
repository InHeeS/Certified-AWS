# RDS
- RDS는 관계형 데이터베이스 서비스 (Relational Database Service)의 약자로 SQL을 쿼리 언어로 사용하는 데이터베이스에 대한 관리형 데이터베이스 서비스를 의미합니다
- 데이터베이스 프로비저닝은 완전히 자동화되어 있으며 기본 운영 체제 패치도 마찬가지입니다 지속적인 백업이 이루어지고 있으며 특정 타임스탬프로 복원할 수 있습니다
- 읽기 성능을 향상시키기 위해 다중 가용 영역(Multi-AZ)을 설정할 수 있습니다
- 스토리지는 EBS의 지원을 받습니다
  - GP2 볼륨 또는 Io1이 무엇인지 이미 알고 있는 것입니다
- `RDS 데이터베이스를 생성할 때 원하는 스토리지 용량을 지정해야 한다는 것이 요지입니다`
  - 최대 임계값을 지정해야 합니다.

# RDS 읽기 전용 복제본과 다중 AZ의 차이
- 이때 주된 RDS 데이터베이스 인스턴스와 두 읽기 전용 복제본 사이에 비동기식 복제가 발생합니다
- SELECT 명령문에만 사용하는 점을 명심해야 합니다
- RDS 읽기 전용 복제본은 관리형 서비스입니다 읽기 전용 복제본이 다른 AZ 상이지만 동일한 리전 내에 있을 때는 비용이 발생하지 않습니다
- ![image](https://github.com/user-attachments/assets/05f52ae4-56f1-4b3f-8a11-a0d45e79bdf5)

---
- RDS 다중 AZ에 대해 알아보죠 다중 AZ는 주로 재해 복구에 사용됩니다
- 동기식으로 이를 AZ B에 스탠바이 인스턴스로 복제합니다
- 스탠바이 데이터베이스에 자동으로 장애 조치가 수행됩니다 => 고가용성
  - 읽거나 쓸 수 없는 db 입니다.
- `하지만 재해 복구를 대비해서 읽기 전용 복제본을 다중 AZ로 설정할 수 있을까요? 네 가능합니다 원하는 경우에는 읽기 전용 복제본을`
  - `다중 AZ로도 설정할 수 있습니다`
- 단일 AZ에서 다중 AZ로 전환할 때에 데이터베이스를 중지할 필요가 없는 겁니다
  - 동기식 복제본인 스탠바이 데이터베이스를 확보하죠
  - 스냅샷은 새로운 스탠바이 데이터베이스에 복원되죠
 - ![image](https://github.com/user-attachments/assets/db62e678-023d-44dd-b240-a4b8461cffc5)

 # Aurora
 - Aurora는 AWS의 독점 기술입니다 오픈 소스는 아니지만, Postgres와 MySQL과 호환되도록 만들어졌죠
 - Aurora 스토리지는 자동으로 늘어나는데
 - 또한 읽기 전용 복제본의 경우, 15개의 복제본까지 가질 수 있는데요
 - Aurora는 RDS의 다중 AZ와 같습니다
   - 읽기 담당 인스턴스는 1개 ~ 15개 이며 쓰기 담당은 master 입니다.
 - 읽기 전용 복제본의 장점은 리전 간 복제를 지원한다는 것인데요
 - `리더 엔드포인트는 라이터 엔드포인트와 정확히 동일한 기능을 갖고 있죠`
 - `연결 로드 밸런싱을 지원하며 모든 읽기 전용 복제본에 자동으로 연결합니다`
 - 자동 장애 조치, 백업 및 복구, 격리성 및 보안, 산업 규정 준수에 대해 앞서 말씀드리기도 했는데요
 - 오토 스케일링을 통한 푸시 버튼 스케일링과 제로 가동 중지 자동 패치도 있습니다

# RDS 및 Aurora 보안 
- 데이터가 볼륨에서 암호화된다는 뜻이죠
- KMS를 사용하여 마스터와 복제본을 암호화해야 합니다
- 이 작업은 데이터베이스를 처음 실행하는 동안 실행 시간에 정의되어야 하죠
- 암호화되지 않은 기존 데이터베이스를 암호화하려면 암호화되지 않은 데이터베이스에서 데이터베이스 스냅샷을 가져온 다음, 해당 데이터베이스 스냅샷을 암호화된 데이터베이스로 복원하면 됩니다

- RDS와 Aurora의 각 데이터베이스는 기본적으로 전송 중 암호화를 사용할 준비가 되어 있습니다
- 따라서 클라이언트는 AWS의 TLS 루트 인증서를 사용해야만 하는데요, 이는 AWS 웹사이트에서 제공됩니다
- 허용하거나 차단할 수 있죠, 마지막으로 RDS와 Aurora는 SSH 액세스를 갖고 있지 않습니다 => 관리형 서비스이기 때문에 
- RDS Custom 서비스는 예외입니다.
- 따라서 더 오랜 기간 동안 보관하고 싶다면 AWS의 CloudWatch 로그 서비스라고 하는 전용 서비스에 전송하면 됩니다

# RDS Proxy
- Amazon RDS 프록시를 사용하면 애플리케이션이 데이터베이스로 설정된 데이터베이스 연결을 풀링하고 공유할 수 있는데요
- CPU, RAM 등 데이터베이스 리소스에 대한 스트레스를 줄여서 데이터베이스 효율성을 향상해 주는데요
- 또한 열린 연결과 데이터베이스에 대한 시간 초과를 최소화하고 하죠
- 앞서 말씀드렸듯이 RDS 프록시는 완전 서버리스이며 오토 스케일링이므로 용량을 관리하지 않아도 되는데요, 다중 AZ를 사용하기 때문에
- RDS 프록시 덕분에 장애 조치 시간이 최대 66%까지 줄어듭니다 to aurora
- RDS 데이터베이스 인스턴스에 대한 장애 조치를 직접 처리하는데, 이에 따라 여러분의 장애 조치 시간이 향상되는 겁니다
- 데이터베이스의 IAM 인증을 시행한다는 점이죠
  - IAM을 사용해야만 RDS 데이터베이스 인스턴스에 연결할 수 있는 겁니다
  - 이러한 자격 증명은 AWS Secrets Manager라는 또 다른 서비스에 안전하게 저장되죠
- 마지막으로 프록시에는 결코 공개적으로 액세스할 수 없는데요, VPC에서만 액세스할 수 있죠
- 인터넷을 통해서는 보안이 강화된 RDS 프록시로 연결할 수 없습니다
- 100 ~ 1000개의 db 연결을 열어주고 있다면 이 경우, RDS 프록시를 사용하여 Lambda 함수에 대한 연결을 풀링해야 합니다

# ElasticCache
- 또한 애플리케이션 상태를 Amazon Elasticache에 입력하여 애플리케이션을 무상태로 만드는 데 도움을 주죠
- Amazon ElastiCache로 세션 데이터를 씁니다 이제 사용자가 애플리케이션의 또 다른 인스턴스로 리디렉션되면, 애플리케이션은Amazon ElastiCache에서 직접 세션의 세션 캐시를 검색하는데요, 이에 따라 사용자는 여전히 로그인된 상태이며 한 번 더 로그인하지 않아도 되죠
- Redis의 경우, 자동 장애 조치를 가진 다중 AZ가 있으며, 읽기 전용 복제본이 있어서 쓰기를 스케일링하고
  - 읽기 전용 복제본 
  - AOF 지속성을 사용하는 데이터 내구성이 있으며, 백업과 복원 기능도 있습니다
  - 핵심은 데이터 내구성과 캐시 기능입니다.
  - 또 set or sorted set 을 지원합니다.
- Memcached는 데이터 파티셔닝에 다중 노드를 사용합니다 이를 샤딩이라고 하는데요
  - Memcached는 분산된 순수 캐시에 불과하다는 사실이죠, 데이터 손실을 감당해야 하며
  - 고가용성, 백업, 복원 기능이 없습니다
- AWS Outposts라는 것을 통해 온프레미스 (On premises)에서 ElastiCache를 생성할 수도 있습니다
- 읽기 전용 복제본이 있다면 리더 엔드포인트를 사용하여 캐시에서 읽을 수 있습니다

# Caching Strategy
- 첫 번째 방식은 레이지 로딩(Lazy Loading)입니다
  - 시험에서는 캐시 어사이드(Cache-Aside)나 레이지 포퓰레이션(Lazy Population) 라고도 합니다
    - 캐시를 한 번 예열해야 하므로 대기 시간은 늘어납니다
    - 캐시 미스일 경우 단점이 될 수 있다.
    - 따라서 캐시에 오래된 데이터가 남아 있을 수 있습니다
- 두 번째 전략은 라이트 스루(Write Through)입니다
  - 라이트 스루는 데이터베이스가 업데이트될 때 캐시를 추가하거나 업데이트하는 것을 의미합니다
  - 일래스틱 캐시를 통해 RDS에 쓰기 때문입니다
  - 데이터베이스로 한 번, 캐시로 한 번입니다 사용자 입장에서는 읽기보다 쓰기에 시간이 더 걸립니다
- 다음 전략은 캐시 제거와 타임 투 리브(TTL)입니다
  - 예를 들어 항목을 캐시에서 명시적으로 삭제하거나 캐시 메모리가 꽉 찼을 때 사용합니다 그러면 가장 최근에 사용되지 않은 항목이 제거됩니다
  - ttl 설정
  - 특히 읽기 성능을 개선할 때 사용됩니다
- 사용자 프로필이나 블로그에 사용하고 가격 데이터에는 사용하지 마세요 또한 은행 계좌 값에도 사용하지 않는 것이 좋습니다.
- 
# Redis 용 amazon memoryDB
- Redis와 Redis용 MemoryDB의 차이점을 말씀드리자면, Redis는 약간의 내구성을 갖춘 캐시로 사용되는데
- MemoryDB는 Redis와 호환되는 API가 있는 데이터베이스죠, 그렇기 때문에 초당 1억 6천만 건의 요청을 처리하는 초고속 성능을 제공합니다
- Redis용 MemoryDB의 사용 사례로는 웹 및 모바일 애플리케이션, 온라인 게임 미디어 스트리밍 등이 있는데요, 마이크로서비스를 보유하고 있다고 가정
- Redis용 MemoryDB를 사용하면 초고속 인 메모리 속도와 다중 AZ 트랜잭션 로그를 얻을 수 있는데 다중 AZ 트랜잭션 로그는 여러 AZ에 저장되어 원하는 경우 빠른 복구와 데이터 내구성에 대한

- ![image](https://github.com/user-attachments/assets/6ebd2330-45c5-4fa5-87cb-d5bd3fbac245)











